# Apache Maven

> Maven нужен для управления жизненным циклом проекта на Java. Он облегчает процесс сборки, конфигурации, развертывания и управления зависимостями.

Apache Maven - это инструмент для управления проектами на платформе Java, который облегчает процесс сборки, управления зависимостями и развертывания приложений.

### Сборка проекта

Maven автоматизирует процесс сборки Java-проекта. Он использует файл конфигурации pom.xml (Project Object Model), в котором определены зависимости, цели сборки, плагины и другие параметры проекта.

### Управление зависимостями

Maven обеспечивает удобный способ управления зависимостями проекта. Зависимости определяются в файле pom.xml и автоматически загружаются из центрального репозитория Maven или других удаленных репозиториев.

### Цикл жизни проекта

Maven определяет стандартный цикл жизни проекта, состоящий из различных фаз (например, компиляция, тестирование, упаковка, развертывание).

### Плагины

Maven использует плагины для выполнения различных задач, таких как компиляция кода, выполнение тестов, создание документации, упаковка проекта и др.

### Управление конфигурациями

Maven позволяет централизованно управлять конфигурациями проекта. Это упрощает процесс сборки и обеспечивает единообразие в различных проектах.

### Автоматизированное развертывание

Maven упрощает процесс развертывания приложений, позволяя создавать исполняемые JAR-файлы, WAR-файлы (для веб-приложений) и другие артефакты.

### Центральный репозиторий

Maven использует центральный репозиторий, в котором хранятся множество библиотек и зависимостей.

<details>
    <summary>
        <b>Структура Maven проекта</b>
    </summary>

> Структура Maven проекта следует определённым конвенциям и обеспечивает удобную организацию файлов и каталогов.

### `pom.xml`   

Файл `pom.xml` (Project Object Model) - основной конфигурационный файл Maven проекта. 

В нем содержатся метаданные о проекте, такие как зависимости, плагины, настройки сборки и другие параметры. 

Также POM указывает на версии используемых библиотек и плагинов Maven.

- ### `src` каталог

  Исходные файлы Java для основного кода проекта

  - ### `src/main/java`

    Исходные файлы Java с основным кодом проекта

  - ### `src/main/resources`

    Основные ресурсы проекта: файлы конфигурации, шаблоны и пр.

  - ### `src/main/webapp` (для web проектов)

    Ресурсы для web проектов: HTML файлы, статические ресурсы, JSP страницы и пр. 

  - `src/test/java`

    ### Исходные файлы Java для тестирования приложения

  - ### `src/test/resources`

    Ресурсы, используемые для тестирования

- ### `target` каталог

  Здесь Maven сохраняет скомпилированные классы, созданные JAR / WAR файлы и другие артефакты сборки проекта. 

  Этот каталог обычно добавляется в .gitignore

- ### `bin` или `target/bin` (опционально)

  Исполняемые файлы (если проект создаёт дополнительные исполняемые файлы) 

- ### `lib` или `target/lib` 

  Внешние библиотеки, необходимые для проекта, которые не могут быть получены из центрального репозитория Maven

> Maven обладает высокой степенью гибкости, и структура проекта может быть настроена в соответствии с требованиями проекта с использованием конфигураций в файле pom.xml.

</details>

<details>
    <summary>
        <b>POM (Project Object Model)</b>
    </summary>

> ### `POM` (Project Object Model) - xml файл, который содержит информацию о проекте и его конфигурации: зависимости, плагины, цели сборки, версии и пр.  

### Пример pom.xml:

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>my-project</artifactId>
    <version>1.0.0</version>

    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>5.2.0.RELEASE</version>
        </dependency>
        <!-- Другие зависимости -->
    </dependencies>

    <build>
        <plugins>
            <!-- Конфигурация плагинов сборки -->
        </plugins>
    </build>
</project>
```

### Основные элементы POM:

- ### `project`

  Корневой элемент POM, включающий все остальные элементы:

  - ### `modelVersion`
  
    Используемая версия схемы POM:

    ```xml
    <modelVersion>4.0.0</modelVersion>
    ```
    
  - ### `groupId`
  
    Идентификатор группы проекта. Ассоциируется с организацией или группой, которая разрабатывае проект:

    ```xml
    <groupId>com.example</groupId>
    ```
    
  - ### `artijfactId`

    Идентификатор артефакта (проекта) в группе:

    ```xml
    <artifactId>my-project</artifactId>
    ```

  - ### `version`

    Версия проекта, которая используется для управления версией артефакта

    ```xml
    <version>1.0.0</vesion> 
    ```
    
  - ### `depdencies`

    Секция, в которой перечисляются все зависимости проекта от внешних библиотек

    ```xml
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>5.2.0.RELEASE</version>
        </dependency>
        <!-- Другие зависимости -->
    </dependencies>

    ```
    
  - ### `build`

    Информация о настройке сборки проекта: плагины Maven, цели и пр.
</details>

<details>
    <summary>
        <b>mvn vs mvnw</b>
    </summary>

> mvn и mvnw относятся к инструментам управления зависимостями и сборки проектов на платформе Java с использованием Apache Maven

- ### `mvn` (или `mvn.cmd` в Windows)`
  Это стандартная команда для запуска Apache Maven. Она требует, чтобы исполняемый файл Maven был предварительно установлен и настроен в вашей операционной системе (в системном пути (PATH))

- ### `mvnw` (или `mvnw.cmd` в Windows):

  Wrapper-скрипт (обертка) Maven, который может быть включен в проект как часть исходного кода. 

  Автоматически скачивает и использует правильную версию Maven, указанную для проекта, если она не установлена в системе, чтобы проект мог быть собран и выполнял различные задачи Maven.

  Гарантирует одинаковое поведение сборки для всех разработчиков.
</details>

<details>
    <summary>
        <b>Жизненный цикл Maven проекта</b>
    </summary>

### Жизненный цикл Maven проекта представляет собой набор фаз (или этапов), через которые проходит проект в процессе сборки и управления зависимостями. <br>Фазы разбиты на три основные стадии: `clean`, `default` и `site`.

### Запуск фаз:
Чтобы выполнить конкретную фазу, вы можете использовать команду вида `mvn фаза` (например, `mvn compile`, `mvn test`). 

При этом Maven автоматически выполнит все предшествующие фазы до выбранной.

В Maven циклы жизни и фазы действуют как последовательные этапы, и по умолчанию, если вы запускаете конкретную фазу, Maven будет выполнять все предшествующие фазы в порядке их следования. Это обеспечивает правильный порядок выполнения задач и гарантирует, что все зависимости будут удовлетворены.

Однако, если вам нужно запустить только конкретную фазу, а не все ее предшествующие, вы можете использовать опцию `--resume-from` в командной строке Maven. Эта опция позволяет вам указать фазу, с которой нужно начать выполнение цикла.

```
mvn clean install --resume-from test
```

- ## Clean Lifecycle

  - `mvn clean`

    Удаляет все сгенерированные артефакты сборки (например, папка target).

- ## Default Lifecycle

  - `mvn validate`

    Проверяет, что проект правильно сконфигурирован и все необходимые ресурсы доступны.

  - `mvn compile`

    Компилирует исходный код проекта.

  - `mvn test`

    Запускает тесты проекта с использованием фреймворка для тестирования (например, JUnit).

  - `mvn package`

    Упаковывает скомпилированные классы и ресурсы в артефакт (например в JAR / WAR)

  - `mvn verify`

    Проверяет качество и валидность собранного артефакта перед тем, как он будет установлен в репозиторий. 

  - `mvn install`

    Устанавливает артефакт в локальный репозиторий Maven (делает артефакт доступным для других проектов на локальном компьютере), чтобы его можно было использовать в других проектах

  - `mvn deploy`

    Устанавливает (развертывает) артефакт в удаленном репозитории (например, Nexus или Artifactory)

- ## Site Lifecycle

  - `mvn site`

    Генерирует документацию, отчеты и другие ресурсы для создания сайта проекта.

  - `mvn site-deploy`

    Разворачивает сгенерированные ресурсы сайта в удаленный репозиторий.

---

## Запуск `build` с пропуском фазы `test`

### 1. Чтобы пропустить этап тестирования (skip tests) при сборке проекта, можно воспользоваться параметром командной строки -DskipTests.

```text
mvn clean install -DskipTests   // Тесты компилируются, но не выполняются
```

### 2. Можно добавить maven-surefire-plugin в файл pom.xml, установив в configuration -> skipTests -> true:

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.22.2</version> <!-- Укажите актуальную версию плагина -->
            <configuration>
                <skipTests>true</skipTests>
            </configuration>
        </plugin>
    </plugins>
</build>
```

```text
mvn clean install -Pskip-tests  // Запускает профиль, где в конфигурации плагина установлен <skipTests>true</skipTests>
```

### 3. Можно создать собственный профиль с помощью плагина maven-surefire-plugin, чтобы управлять выполнением тестов:

```xml
<profiles>
    <profile>
        <id>skip-tests</id>
        <build>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <version>2.22.2</version> <!-- Укажите актуальную версию плагина -->
                    <configuration>
                        <skipTests>true</skipTests>
                    </configuration>
                </plugin>
            </plugins>
        </build>
    </profile>
</profiles>
```

```text
mvn clean install -Pskip-tests  // Запускает профиль, где в конфигурации плагина установлен <skipTests>true</skipTests>
```

### 4. Полное отключение компиляции тестов

```text
mvn clean install -Dmaven.test.skip=true    // Тесты не компилируются и не выполняются
```
</details>

<details>
    <summary>
        <b>Maven репозитории</b>
    </summary>

## Локальные репозитории Maven

Maven использует локальный репозиторий по умолчанию, который расположен в директории пользователя в папке `.m2/repository`. 

Здесь хранятся все скачанные зависимости.

Maven можно настроить для использования другого локального репозитория, задав переменную `settings.xml` или указав путь к репозиторию в файле `pom.xml` проекта.

## Удаленные репозитории Maven

Центральный репозиторий Maven - это основной удаленный репозиторий, который содержит множество широко используемых библиотек и зависимостей. 

Maven автоматически обращается к центральному репозиторию, если не может найти зависимость в локальном репозитории.

В зависимости от требований вашего проекта, вы можете настроить Maven для использования других удаленных репозиториев. 

Это может быть полезно, если ваши зависимости находятся в других репозиториях, не связанных с центральным (например GitHub Packages).

---

## Работа с Maven-репозиториями

### Добавление зависимостей

В файле `pom.xml` проекта определяются зависимости указанием их координат (`groupId`, `artifactId`, `version`). 
Maven автоматически загрузит эти зависимости из локального или удаленного репозитория.

```xml
<dependencies>
    <dependency>
        <groupId>group-id</groupId>
        <artifactId>artifact-id</artifactId>
        <version>version</version>
    </dependency>
</dependencies>
```

### Сборка проекта

При сборке проекта с помощью команды `mvn clean install`, Maven автоматически проверяет зависимости и загружает их из локального или удаленного репозитория, если они отсутствуют.

### Публикация артефактов

Если вы разрабатываете библиотеку или приложение и хотите поделиться своим кодом с другими, вы можете опубликовать свои артефакты в удаленном репозитории. Для этого используется команда mvn deploy.

```xml
<distributionManagement>
    <repository>
        <id>remote-repository</id>
        <url>https://example.com/repo</url>
    </repository>
</distributionManagement>
```

После этого вы можете использовать команду mvn deploy для публикации артефактов в указанный удаленный репозиторий.

---

## `settings.xml`

Конфигурационный файл Maven, который содержит настройки для среды выполнения Maven. 
Этот файл можно использовать для определения различных параметров, таких как настройки прокси, профили, удаленные репозитории и другие конфигурационные параметры.

В общем, файл `settings.xml` обычно находится в директории `${Maven_Home}/conf` (где `${Maven_Home}` - это директория, в которую установлен Maven. 
Он может также быть расположен в директории `.m2` в домашней директории пользователя. 
Если файл не существует в пользовательской директории, Maven использует файл из директории `${Maven_Home}/conf`.

### Некоторые основные элементы, которые вы можете определить в файле `settings.xml`:

- ### `localRepository`

  Этот элемент определяет путь к локальному репозиторию Maven. Если он не указан, Maven использует локальный репозиторий по умолчанию (.m2/repository в домашней директории пользователя).

  ```xml
  <localRepository>/полный/путь/к/локальному/репозиторию</localRepository>
  ```

- ### `mirrors`

  mirrors позволяет настроить зеркала репозиториев. 
  Зеркало - это копия удаленного репозитория, которая может использоваться для ускорения загрузки зависимостей.

  ```xml
  <mirrors>
    <mirror>
        <id>mirrorId</id>
        <url>http://mirror.example.com/repo</url>
        <mirrorOf>central</mirrorOf>
    </mirror>
  </mirrors>
  ```

- ###  `proxies` 

  Этот элемент позволяет настроить параметры прокси, если они необходимы для выхода в Интернет через прокси-сервер.

  ```xml
  <proxies>
    <proxy>
        <id>example-proxy</id>
        <active>true</active>
        <protocol>http</protocol>
        <host>proxy.example.com</host>
        <port>8080</port>
        <username>proxy-user</username>
        <password>proxy-password</password>
        <nonProxyHosts>www.google.com|*.example.com</nonProxyHosts>
    </proxy>
  </proxies>
  ```

> Обычно на каждом проекте новым разработчикам дают готовый `settings.xml` в который нужно прописать свои учетные данные.
</details>

<details>
    <summary>
        <b>Версионирование билдов в Maven</b>
    </summary>

> Теория версионирования обычно включает в себя систему трех уровней версий: мажорные (`Major`), минорные (`Minor`) и патчи (`Patch`). 
> Это стандартный способ обозначения изменений в программном обеспечении, предоставляя информацию о характере изменений и их совместимости с предыдущими версиями.

## Мажорные версии (Major)

Увеличение мажорной версии обычно свидетельствует о внесении несовместимых изменений, которые могут повлиять на API, интерфейсы пользователя и т. д. 
Повышение мажорной версии может также указывать на внедрение значительных новых функциональных возможностей.

## Минорные версии (Minor)

Увеличение минорной версии обычно свидетельствует о внесении обратно совместимых новых функций или улучшений, не нарушающих существующие интерфейсы. 
Минорные обновления могут также включать в себя исправления ошибок.

## Патчи (Patch)

Увеличение патча обычно связано с внесением обратно совместимых исправлений ошибок и мелких улучшений. 
Эти изменения не должны вносить несовместимости и не должны влиять на функциональность, предоставленную API.

### Пример версионирования в формате `MAJOR.MINOR.PATCH`:

```text
1.2.3

1 - мажорная версия
2 - минорная версия
3 - патч
```

---

> `SemVer` - это сокращение от "Semantic Versioning" (Семантическое версионирование). Это стандарт, который определяет схему версионирования для программного обеспечения, предоставляя четкий и структурированный способ обозначения изменений в версиях программного продукта.

### Примеры сравнения версий:

`1.2.3` и `1.2.4` - Предполагается, что это безопасное обновление, так как изменения затрагивают только патч.

`1.2.3` и `1.3.0` - Минорное изменение может добавить новые функции, но, согласно SemVer, не должно нарушать обратную совместимость.

`1.2.3` и `2.0.0` - Мажорное изменение может включать несовместимые изменения API, и обновление может потребовать внесения изменений в ваш код. 

> Версионирование билдов в Maven может включать в себя использование различных стратегий для уникальной идентификации и отслеживания каждой версии вашего проекта в процессе разработки.

## В Maven существует несколько подходов к версионированию билдов:

### Фиксированная версия

Проект может иметь фиксированную версию, например, `<version>1.0</version>`. 

Этот подход подходит, если вы не планируете выпускать регулярные обновления и предпочитаете иметь стабильную версию.

### Инкрементальные версии

Вы можете использовать инкрементальное увеличение версии с каждым новым билдом. Например, `<version>1.0.1</version>`, `<version>1.0.2</version>`, и так далее. 

Этот метод подходит для регулярных обновлений, когда каждый билд представляет собой небольшое изменение в проекте.

### Снимки (Snapshots)

Когда проект находится в активной разработке, вы можете использовать `SNAPSHOT` версии, `<version>1.0-SNAPSHOT</version>`. 

Они обеспечивают динамическое обновление зависимостей и предоставляют возможность автоматически использовать самые свежие изменения при сборке проекта.

### Временные метки (Timestamps) в SNAPSHOT версиях

Для более точной идентификации SNAPSHOT версий, Maven добавляет временные метки к ним при каждой сборке (`<version>1.0-20220101.012345-1</version>`, где 20220101.012345 - временная метка).

Пример использования временных меток в SNAPSHOT версии в файле pom.xml:

```xml
<version>1.0-20220101.012345-1</version>
```
</details>

<details>
    <summary>
        <b>Дерево зависимостей в Maven</b>
    </summary>

## Дерево зависимостей позволяет увидеть, какие библиотеки используются в проекте, а также их версии:

```text
mvn dependency:tree
```

## Пример вывода команды `dependency:tree`:

```text
[INFO] com.example:my-project:jar:1.0.0
[INFO] \- org.springframework:spring-core:jar:5.2.0.RELEASE:compile
[INFO]    \- org.springframework:spring-jcl:jar:5.2.0.RELEASE:compile
```

Этот пример показывает дерево зависимостей для простого проекта с одной зависимостью от Spring Framework. 

Вы видите, что my-project зависит от spring-core, и также видите транзитивную зависимость от spring-jcl.

## Просмотр дерева зависимостей в Maven нужен для:

- ### `Понимание зависимостей проекта` <br>Помогает понять, какие библиотеки используются в проекте, а также их версии. Это полезно для обеспечения согласованности и правильного управления зависимостями.

- ### `Выявление конфликтов зависимостей` <br>Если в проекте есть конфликты зависимостей (например, две разные библиотеки требуют разных версий одной и той же библиотеки), дерево зависимостей может помочь в их выявлении.

- ### `Отслеживание транзитивных зависимостей` <br>Позволяет увидеть все транзитивные зависимости, которые Maven автоматически включает в проект на основе указанных зависимостей. Это важно для обеспечения правильной работы всех компонентов приложения.

- ### `Оптимизация зависимостей` <br>Может помочь в оптимизации списка зависимостей, уменьшая количество и избегая избыточных библиотек.

- ### `Анализ структуры проекта` <br>Может предоставить обзор структуры проекта и его связей с внешними библиотеками.
</details>

<details>
    <summary>
        <b>Dependency Management (управление зависимостями) в Maven:</b>
    </summary>

> использование `<dependencyManagement>` в Maven предоставляет эффективный механизм управления зависимостями, что способствует удобству, поддержке и консистентности в разработке проектов.

### В `pom.xml` можно определить раздел `dependencyManagement`, в котором указываются версии зависимостей. Это позволяет централизованно управлять версиями библиотек в проекте.

```xml
<dependencyManagement>
    
    <dependencies>
        
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-api</artifactId>
            <version>2.14.1</version>
        </dependency>
        <!-- Другие зависимости -->
    
    </dependencies>

</dependencyManagement>
```

Это не приводит к автоматической включенной зависимости в проект, но позволяет проектам унаследовать версии из родительского POM, если они не указаны явно.

### В Maven, блок `<dependencyManagement>` в файле `pom.xml` позволяет определить версии зависимостей централизованно для проекта, но не навязывает их использование. 

Это предоставляет координаты (`groupId`, `artifactId`, `version`) для зависимостей, которые могут использоваться в различных модулях проекта.

Если какой-то модуль проекта (например, другой модуль или подпроект) хочет использовать зависимость, определенную в блоке `<dependencyManagement>`, ему нужно явно указать эту зависимость в своем собственном блоке `<dependencies>`. 

Таким образом, `<dependencyManagement>` предоставляет стандартные версии, которые могут быть использованы в различных частях проекта.

```xml
<dependencyManagement>
    
   <dependencies>
       
       <dependency>
           <groupId>org.apache.logging.log4j</groupId>
           <artifactId>log4j-api</artifactId>
           <version>2.14.1</version>
       </dependency>
       
   </dependencies>
    
</dependencyManagement>

<dependencies>
    <!-- Другие зависимости -->
    <dependency>
        <groupId>org.apache.logging.log4j</groupId>
        <artifactId>log4j-api</artifactId>
        <!-- Нет необходимости указывать версию, она унаследуется из dependencyManagement -->
    </dependency>

</dependencies>

```

Если другой модуль проекта добавит зависимость на `log4j-api`, Maven автоматически использует версию, указанную в блоке.

Важно отметить, что `<dependencyManagement>` не принуждает модули к использованию определенной версии. 

Он предоставляет централизованное место для указания версий, но разработчики могут явно указывать версии в своих собственных зависимостях, если это необходимо.

> Чтобы атрибуты дочерней зависимости брались из родительского POM:<br>
> В дочернем POM при объявлении зависимости можно опустить атрибуты: `version`, `scope`, `type`, `classifier`, `exclusions`<br>
> Но нельзя опустить: `groupId` и `artifactId`

---

## Централизованное управление версиями

Позволяет централизованно управлять версиями зависимостей в проекте. 

Если проект состоит из нескольких модулей, блок `<dependencyManagement>` в родительском POM предоставляет единое место для установки версий, что упрощает поддержку и обновление.

## Избежание дублирования информации

При использовании `<dependencyManagement>` версии зависимостей указываются только один раз. 

Это уменьшает риск ошибок и упрощает поддержание, поскольку нет необходимости повторять информацию о версиях в каждом модуле.

## Повышение согласованности

Позволяет обеспечить согласованность версий зависимостей в проекте. 

Все модули, использующие одну и ту же зависимость, будут использовать единую версию, предоставленную в блоке `<dependencyManagement>`.

## Облегчение обновлений

При необходимости обновления версии зависимости, это можно сделать только в блоке `<dependencyManagement>`. 

После этого все модули проекта, использующие эту зависимость, автоматически наследуют новую версию.

## Легкость чтения и понимания проекта

Помогает сделать POM более читаемым и понятным, так как разработчики могут легко определить централизованные версии зависимостей, используемых в проекте.
</details>

<details>
    <summary>
        <b>Maven Plugin</b>
    </summary>

> `Maven Plugin` - это модуль, который добавляет в Maven новые цели (`goals`) для выполнения конкретных задач (компиляция, тестирование, упаковка и т.д.).

### Maven позволяет создавать и использовать собственные плагины если нужно:

- Автоматизировать повторяющуюся задачу, специфичную для проекта (например, генерацию кода, валидацию конфигураций, деплой в кастомную среду)
- Интегрировать кастомный инструмент в `lifecycle` Maven
- Переиспользовать логику сборки между несколькими проектами
- Расширить стандартный набор команд Maven (помимо `clean`, `compile`, `package`)

### Примеры кастомных плагинов:

- Генератор документации из аннотаций.
- Плагин для загрузки артефактов в собственный репозиторий.
- Валидатор структуры проекта перед коммитом.

---

## Создание собственного Maven плагина

### Создание проекта Maven

```bash

# Запуск генерации проекта Maven из архетипа
mvn archetype:generate \ 
  
  # Уникальный идентификатор организации (например, домен наоборот)
  -DgroupId=com.example \
  
  # Имя проекта (будет использовано как имя плагина и артефакта)
  -DartifactId=my-maven-plugin \
  
  # Ключевой параметр: указываем специальный архетип для создания плагинов Maven
  # Этот архетип создаст правильную структуру проекта с зависимостями для Mojo (Maven plugin)
  -DarchetypeArtifactId=maven-archetype-mojo \
  
  # Отключаем интерактивный режим - все параметры берутся из командной строки
  -DinteractiveMode=false

# ПРИМЕЧАНИЕ: Команда должна выполняться одной строкой или с использованием \
# для переноса (как показано выше). В Windows используйте ^ вместо \ для переноса.
```

### Создание Mojo класса

Mojo (Maven plain Old Java Object) — это класс, который реализует логику вашего плагина.

```java
package com.example.my.maven.plugin;

import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugin.MojoFailureException;
import org.apache.maven.plugins.annotations.Mojo;
import org.apache.maven.plugins.annotations.Parameter;

@Mojo(name = "hello") // Аннотация @Mojo(name = "hello") указывает, что этот Mojo будет вызываться командой mvn hello
public class HelloMojo extends AbstractMojo {

    @Parameter(property = "hello.name", defaultValue = "World") // Аннотация @Parameter используется для определения параметров плагина
    private String name;

    @Override // Метод execute() содержит логику плагина.
    public void execute() throws MojoExecutionException, MojoFailureException {
        getLog().info("Hello, " + name + "!");
    }
}
```

### Настройка pom.xml (проекта плагина)

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>my-maven-plugin</artifactId>
    <version>1.0-SNAPSHOT</version>
    <!-- packaging установлен в maven-plugin, чтобы плагин собрался как плагин (не JAR / WAR) -->
    <packaging>maven-plugin</packaging>

    <name>My Maven Plugin</name>

    <dependencies>
        
        <dependency>
            <!-- maven-plugin-api - "стандартная библиотека" для плагинов -->
            <groupId>org.apache.maven</groupId>
            <artifactId>maven-plugin-api</artifactId>
            <version>3.6.3</version>
        </dependency>
        
        <dependency>
            <groupId>org.apache.maven.plugin-tools</groupId>
            <!-- maven-plugin-annotations - для аннотаций (@Mojo, @Parameter) -->
            <artifactId>maven-plugin-annotations</artifactId>
            <version>3.6.0</version>
            <!-- Нужны только для компиляции -->
            <scope>provided</scope>
        </dependency>
        
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <!-- Это плагин для сборки плагинов:
                1. Генерирует дескриптор плагина (plugin.xml)
                2. Создает документацию
                3. Проверяет аннотации -->
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-plugin-plugin</artifactId>
                <version>3.6.0</version>

                <configuration>
                    <!-- Устанавливаем префикс, который позволяет при вызове плагина использовать псевдоним:
                    "mvn com.example:my-maven-plugin:hello" если не указывать goalPrefix 
                    "mvn myplugin:hello" если указали goalPrefix = myplugin -->
                    <goalPrefix>myplugin</goalPrefix>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

### Сборка плагина

```text
cd my-plugin-project
mvn clean install  # Собирает плагин и кладет в локальный репозиторий
```

### Установка зависимости в другой проект

```xml

<project>
    <groupId>com.mycompany</groupId>
    <artifactId>my-app</artifactId>
    <version>1.0</version>

    <build>
        <plugins>
            <!-- Здесь подключаем плагин -->
            <plugin>
                <groupId>com.example</groupId>              <!-- Из pom.xml проекта плагина -->
                <artifactId>my-maven-plugin</artifactId>    <!-- Из pom.xml проекта плагина -->
                <version>1.0-SNAPSHOT</version>             <!-- Из pom.xml проекта плагина -->

                <configuration>
                    <!-- Глобальные настройки плагина для ВСЕХ executions этого плагина
                    Или если плагин вызывается без executions (например, mvn myplugin:hello)
                    Например:
                    <name>Default Name</name>
                    <enabled>true</enabled> -->
                </configuration>

                <executions>
                    <execution>

                        <phase>validate</phase>  <!-- Когда запускать -->

                        <goals>
                            <!-- Goal из Mojo -->
                            <goal>hello</goal>
                        </goals>

                        <!-- Локальные настройки для этого конкретного execution (запуска) плагина
                        Могут переопределять глобальную конфигурацию
                        Разные настройки для разных фаз / целей (может быть несколько) -->
                        <configuration>
                            <name>Maven</name>

                        </configuration>

                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
```

### Использование плагина

Без goalPrefix:

```text
mvn com.example:my-maven-plugin:hello
```

С использованием goalPrefix:

```text
mvn myplugin:hello
```

Параметры можно также передавать через командную строку:

```text
mvn myplugin:hello -Dhello.name="Developer"
```

Вывод:

```text
[INFO] Hello, Maven!
```
</details>










